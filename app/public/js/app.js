// Generated by CoffeeScript 1.8.0
define(['ehbs!templates/index', 'ehbs!templates/questions'], function() {
  var app;
  return app = {
    "do": function() {
      var App;
      App = Ember.Application.create();
      App.Router.map(function() {
        return this.route('index', {
          path: '/'
        });
      });
      App.IndexView = Ember.View.extend({
        didInsertElement: function() {
          this._super();
          return $('.btn-next').click();
        }
      });
      App.IndexController = Ember.ObjectController.extend({
        needs: 'questions',
        actions: {
          next: function() {
            var thiz;
            thiz = this;
            $.get('apis/questions/next', function(data) {
              var key, q, questions, _i, _len, _ref;
              key = Object.keys(data.data)[0];
              questions = [];
              _ref = data.data[key];
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                q = _ref[_i];
                questions.push({
                  isSelected: false,
                  text: q
                });
              }
              data = {
                file: data.file,
                question: key,
                questions: questions
              };
              return thiz.set('controllers.questions.model', data);
            }).fail(function(err) {
              return thiz.set('controllers.questions.model', {
                question: 'There is nothing to label at the moment'
              });
            });
            return false;
          },
          done: function() {
            var data, questions, upload;
            data = this.get('controllers.questions.model');
            questions = data.questions.filter(function(q) {
              if (q.isSelected) {
                return true;
              }
              return false;
            });
            questions = questions.map(function(q) {
              return q.text;
            });
            upload = {
              file: data.file,
              question: data.question,
              questions: questions
            };
            $.ajax({
              type: 'POST',
              url: 'apis/questions/new',
              data: JSON.stringify(upload),
              dataType: 'json',
              contentType: 'application/json; charset=utf-8',
              success: function(res) {
                return console.log(res);
              },
              failure: function(res) {
                return console.log(res);
              }
            });
            return false;
          }
        }
      });
      return App.QuestionsController = Ember.ObjectController.extend({});
    }
  };
});
