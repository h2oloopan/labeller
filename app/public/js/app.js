// Generated by CoffeeScript 1.8.0
define(['../../set'], function(set) {
  var app;
  return app = {
    "do": function() {
      var App;
      App = Ember.Application.create();
      App.ApplicationRoute = Ember.Route.extend({
        model: function() {
          return set;
        }
      });
      App.ApplicationController = Ember.ObjectController.extend({
        needs: 'questions',
        file: {},
        counter: 0,
        isAdded: false,
        actions: {
          next: function() {
            var counter, file, item, key, keys, list, one, question, questions, request, selected, _i, _j, _len, _len1;
            counter = this.get('counter');
            if (counter > 0 && !this.get('isAdded')) {
              file = this.get('file');
              request = this.get('controllers.questions.request');
              questions = this.get('controllers.questions.questions');
              selected = [];
              for (_i = 0, _len = questions.length; _i < _len; _i++) {
                question = questions[_i];
                if (question.isSelected) {
                  selected.push(question.text);
                }
              }
              file[request] = selected;
              this.set('file', file);
            }
            list = this.get('model');
            keys = Object.keys(list);
            key = keys[counter];
            item = list[key];
            questions = [];
            for (_j = 0, _len1 = item.length; _j < _len1; _j++) {
              one = item[_j];
              questions.push({
                text: one,
                isSelected: false
              });
            }
            this.set('controllers.questions.request', key);
            this.set('controllers.questions.questions', questions);
            this.set('counter', counter + 1);
            return false;
          },
          dump: function() {
            var blob, file, fileName, question, questions, request, selected, _i, _len;
            if (this.get('counter') > 0 && !this.get('isAdded')) {
              file = this.get('file');
              request = this.get('controllers.questions.request');
              questions = this.get('controllers.questions.questions');
              selected = [];
              for (_i = 0, _len = questions.length; _i < _len; _i++) {
                question = questions[_i];
                if (question.isSelected) {
                  selected.push(question.text);
                }
              }
              file[request] = selected;
              this.set('file', file);
              this.set('isAdded', true);
            }
            file = this.get('file');
            blob = new Blob([JSON.stringify(file)], {
              type: 'application/json;charset=utf-8'
            });
            fileName = (new Date()).toString();
            saveAs(blob, fileName + '.json');
            return false;
          }
        }
      });
      App.QuestionsController = Ember.ArrayController.extend({
        needs: ['question', 'application'],
        actions: {
          done: function(questions) {
            var a, blob, file, fileName, q, question, _i, _j, _k, _len, _len1, _len2, _ref, _ref1;
            file = {
              question: this.get('controllers.application.questionTokens'),
              answer: this.get('controllers.application.answerTokens'),
              selected: []
            };
            for (_i = 0, _len = questions.length; _i < _len; _i++) {
              question = questions[_i];
              if (question.isSelected) {
                file.selected.push({
                  id: question.id,
                  questiontitle_original: question.questiontitle_original
                });
              }
            }
            blob = new Blob([JSON.stringify(file)], {
              type: 'application/json;charset=utf-8'
            });
            fileName = '';
            _ref = file.question;
            for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
              q = _ref[_j];
              fileName += q;
              fileName += '-';
            }
            fileName += '___';
            _ref1 = file.answer;
            for (_k = 0, _len2 = _ref1.length; _k < _len2; _k++) {
              a = _ref1[_k];
              fileName += a;
              fileName += '-';
            }
            return saveAs(blob, fileName + '.json');
          }
        }
      });
      App.QuestionController = Ember.ObjectController.extend({
        needs: 'questions'
      });
      return false;
    }
  };
});
